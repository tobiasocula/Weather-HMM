
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Continuous HMM - NAME OF PROJECT</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#evaluation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NAME OF PROJECT" class="md-header__button md-logo" aria-label="NAME OF PROJECT" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NAME OF PROJECT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Continuous HMM
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NAME OF PROJECT" class="md-nav__button md-logo" aria-label="NAME OF PROJECT" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NAME OF PROJECT
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Continuous HMM
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous HMM
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viterbi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Viterbi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictions-when-future-observations-are-unknown" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictions when future observations are unknown
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimenting-with-initial-parameter-guesses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experimenting with initial parameter guesses
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viterbi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Viterbi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictions-when-future-observations-are-unknown" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictions when future observations are unknown
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimenting-with-initial-parameter-guesses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experimenting with initial parameter guesses
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Continuous HMM</h1>

<p>In the file <code>weather_hmm_continuous.ipynb</code> I have reconstructed the weather HMM from the previous implementation, but with a more interesting approach. I have extended the set of possible states from {rain, no rain} to {rain and warm, rain and cold, dry and warm, dry and cold}, but most importantly made the observation space a continuous length-2 vector (temperature, rain_intensity).</p>
<p>A few interesting things change in the implementation.</p>
<p>Now, instead of <span class="arithmatex">\(B\)</span> being a static <span class="arithmatex">\(N\times M\)</span> matrix where <span class="arithmatex">\(B_{i,k}=\mathbb{P}(\text{emitted observation }k\text{ in state }i)\)</span> (where <span class="arithmatex">\(N\)</span> is the amount of states and <span class="arithmatex">\(M\)</span> the amount of observable states), now B is a <span class="arithmatex">\(T\times M\)</span> matrix where <span class="arithmatex">\(B_{t,k}=b_t(k)=\mathbb{P}(O_t=o_k\ |\ S_t=k)\)</span>. Here, <span class="arithmatex">\(O_t\)</span> is a stochastic variable following a multivariable Gaussian distribution, with mean <span class="arithmatex">\(\mu_i\)</span> being the mean observation vector of state <span class="arithmatex">\(i\)</span> (two components here) and covariance matrix <span class="arithmatex">\(\Sigma_i\)</span> encoding the interdependence and relative variance between the labels "temperature" and "rain intensity" of state <span class="arithmatex">\(i\)</span>. So we can calculate <span class="arithmatex">\(b_t(k)\)</span> by computing the PDF function of the multivariate Gaussian distribution with parameters <span class="arithmatex">\(\mu_i\)</span> and <span class="arithmatex">\(\Sigma_i\)</span>. However, since we are working with logarithms, we will be computing the log of this value.</p>
<h4 id="evaluation">Evaluation</h4>
<p>For the evaluation step, a few things change as well.<br />
Instead of computing the permutation indices (by using the Hungarian method again) by using <span class="arithmatex">\(B\)</span>, now we cannot do this, because <span class="arithmatex">\(B\)</span> isn't a static <span class="arithmatex">\(M\times N\)</span> matrix anymore. We instead obtain the permutation indeces by matching using the true and estimated values of <span class="arithmatex">\(\mu\)</span> and <span class="arithmatex">\(\Sigma\)</span>.</p>
<p>For this, we use a measure of statistical difference called the KL-divergence.</p>
<p>https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence</p>
<p>We will compute the "difference" between <span class="arithmatex">\(\Sigma_{\text{estimated}}\)</span> and <span class="arithmatex">\(\Sigma_{\text{real}}\)</span> using this method, but because this function is not symmetric, we will compute</p>
<p><span class="arithmatex">\(D_{\text{sym}}(P,Q)=D_{KL}(P\ |\ Q)+D_{KL}(Q\ |\ P)\)</span></p>
<p>with <span class="arithmatex">\(P=\Sigma_{\text{estimated}}\)</span> and <span class="arithmatex">\(Q=\Sigma_{\text{real}}\)</span>, as the measure we will use for permuting the matrices.<br />
For the multivariate normal distribution, there exists a close form of this formula:</p>
<p><span class="arithmatex">\(D_{KL}(\mathcal{N}(\mu_1,\Sigma_1)\ |\ \mathcal{N}(\mu_2,\Sigma_2))=\frac{1}{2}(\text{Tr}(\Sigma_{2}^{-1}\Sigma_{1})+(\mu_2-\mu_1)^T\Sigma_{2}^{-1}(\mu_2-\mu_1)-d+\text{log}(\text{det}\Sigma_2/\text{det}\Sigma_1))\)</span></p>
<p>with <span class="arithmatex">\(d\)</span> being the dimensionality of the data (2 in this case).<br />
We can then construct a distance matrix <span class="arithmatex">\(C\in\mathbb{R}^{M\times M}\)</span> where</p>
<p><span class="arithmatex">\(C_{i,j}=D_{\text{sym}}(\Sigma_{i}^{\text{estimated}}\ |\ \Sigma_{i}^{\text{real}})\)</span></p>
<p>and then use the Hungarian algorithm on this cost matrix.</p>
<h5 id="viterbi">Viterbi</h5>
<p>Not much changes here, except for the fact that we have to modify the calculation for <span class="arithmatex">\(\delta\)</span> a bit, since the structure of <span class="arithmatex">\(B\)</span> is different now.</p>
<h5 id="predictions-when-future-observations-are-unknown">Predictions when future observations are unknown</h5>
<p>For this step, the only thing that changes is the fact that now we use the argmax of the mean temperature and rain values for each state, instead of deriving it using <span class="arithmatex">\(B\)</span>. We also have, of course, that the predicted observation structure is now a <span class="arithmatex">\(T\times 2\)</span> matrix (rows for temperature and rain):</p>
<p><span class="arithmatex">\(\bar{O}_{T,m}=\underset{j}{\mathrm{argmax}}\ \mu_{j,m}\)</span></p>
<p>We then compute the predicted observation at time <span class="arithmatex">\(t\)</span> and feature <span class="arithmatex">\(m\)</span> (here we have <span class="arithmatex">\(m\in\{0,1\}\)</span>):</p>
<p><span class="arithmatex">\(\bar{O}_{t,m}=\pi\mu_{:,m}\)</span></p>
<p>where <span class="arithmatex">\(\mu_{:,m}\)</span> is the m-th column of <span class="arithmatex">\(\mu\)</span>.</p>
<h3 id="experimenting-with-initial-parameter-guesses">Experimenting with initial parameter guesses</h3>
<p>For both of the intstances of the weather HMM, I wanted to experiment how far or close the estimated parameters come during the training to the actual parameters.</p>
<p>To research this, I experimented with the initial parameter distribution for <span class="arithmatex">\(A\)</span>, <span class="arithmatex">\(B\)</span>, and <span class="arithmatex">\(\pi\)</span> by modifying their generation algorithms.</p>
<p>I started out by simply adding noise to the true values and making sure all probabilities where in the bounds of 0.01 and 0.9:</p>
<div class="highlight"><pre><span></span><code>A_first_col = np.clip(A_real_first_col + np.random.normal(0, 0.2, 2), a_min=0.01, a_max=0.9)
A = np.empty((2, 2))
A[:, 0] = A_first_col
A[:, 1] = 1 - A_first_col

B_first_col = np.clip(B_real_first_col + np.random.normal(0, 0.05, 2), a_min=0.01, a_max=0.9)
B = np.empty((2, 2))
B[:, 0] = B_first_col
B[:, 1] = 1 - B_first_col

p = np.clip(pi_real[0] + np.random.normal(0, 0.05), a_min=0.01, a_max=0.9)
pi = np.array([p, 1 - p])
</code></pre></div>
<p>This, expectedly so, worked very well. If we look at the convergence of the log-likelyhood:</p>
<p><img alt="alt text" src="assets/image.png" /></p>
<p>And the distribution of the fraction of correct state guesses when having used the viterbi algorithm:</p>
<p><img alt="alt text" src="assets/image-2.png" /></p>
<p>The best and worst fraction of correct guesses looks like</p>
<div class="highlight"><pre><span></span><code>maximum pct correct: 0.8240000000000001 from attempt 4
minimum pct correct: 0.62 from attempt 3
</code></pre></div>
<p>I then experimented by using a uniform distribution to make the initial guesses, instead of having to rely on the true parameters.</p>
<div class="highlight"><pre><span></span><code>A_first_col = np.random.uniform(0.3, 0.7, 2)
A = np.empty((2, 2))
A[:, 0] = A_first_col
A[:, 1] = 1 - A_first_col

B_first_col = np.random.uniform(0.3, 0.7, 2)
B = np.empty((2, 2))
B[:, 0] = B_first_col
B[:, 1] = 1 - B_first_col

p = np.random.uniform(0.3, 0.7)
pi = np.array([p, 1 - p])
</code></pre></div>
<p>This method of parameter initialization is clearly more realistic. If we look at the log-likelyhood distribution in this case, we can see:</p>
<p><img alt="alt text" src="assets/image-3.png" /></p>
<p>And the distribution of the fraction of correct state guesses when having used the viterbi algorithm:</p>
<p><img alt="alt text" src="assets/image-5.png" /></p>
<p>The best and worst fraction of correct guesses looks like</p>
<div class="highlight"><pre><span></span><code>maximum pct correct: 0.812 from attempt 2
minimum pct correct: 0.366 from attempt 6
</code></pre></div>
<p>What is interesting is that using both methods, we can see that pretty much all log-likelyhood values converge to about the same value. However, the error term in the parameter estimations (second plot) is larger in the second attempt, which makes intuitive sense. We can also see the distribution of the fraction of correct state estimations varies more in the second attempt, which again makes sense because we are spreading our guesses more.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>